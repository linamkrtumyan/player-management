# Player Balance Manager

React-приложение для отображения списка устройств и управления балансами игроков. Взаимодействие с API через Swagger: https://dev-space.su/swagger/index.html

## Стек

- **React 19** + **TypeScript**
- **React-Bootstrap 2** + **Bootstrap 5** (максимальное использование компонентов)
- **TanStack Query** (React Query) для управления состоянием и кэшированием
- **Axios** для HTTP-запросов
- **Vite** для сборки
- **Vitest** для тестирования

## Запуск

```bash
# Установка зависимостей
yarn install

# Запуск dev-сервера
yarn dev

# Сборка для продакшна
yarn build

# Превью продакшн-сборки
yarn preview

# Запуск тестов
yarn test

# Тесты в watch-режиме
yarn test:watch
```

## Конфигурация API

По умолчанию используется базовый URL: `https://dev-space.su`.

Чтобы указать другой хост (например, для локального бэкенда), создайте файл `.env` в корне проекта:

```env
VITE_API_BASE_URL=https://your-api-host.com
```

После изменения переменных перезапустите `yarn dev`.

## Структура API

### Эндпоинты

- **GET** `/api/v1/a/devices/` — получение списка устройств
- **GET** `/api/v1/a/devices/{device_id}/` — получение устройства с массивом `places`
- **POST** `/api/v1/a/devices/{device_id}/place/{place_id}/update` — обновление баланса (delta: положительное для deposit, отрицательное для withdraw)

### Формат данных

**Устройство:**
```json
{
  "id": 1,
  "name": "Test Device 1",
  "places": [
    {
      "device_id": 1,
      "place": 1,
      "currency": "KES",
      "balances": -35500
    }
  ],
  "created_at": "2025-08-29T13:23:57.796Z",
  "updated_at": "2025-08-29T13:23:57.796Z"
}
```

**Запрос на обновление баланса:**
```json
{
  "delta": 100.50
}
```

**Ответ (200 OK):**
```json
{
  "balances": 500.00,
  "currency": "KES",
  "device_id": 1,
  "place": 1
}
```

**Ошибки (400, 401, 408, 500):**
```json
{
  "err": "Недостаточно средств",
  "data": "string"
}
```

Типы запросов/ответов описаны в `src/types/index.ts`. Эндпоинты можно изменить в `src/api/devices.ts` и `src/api/players.ts`.

## Функциональность

### Навигация

- **Страница устройств** — список всех доступных устройств
- **Страница игроков** — список игроков выбранного устройства с операциями баланса
- Плавные переходы между страницами с анимациями

### Список устройств

- Загрузка устройств с API
- При клике на устройство — переход на страницу игроков
- Визуальное выделение активного устройства
- Анимации при наведении и выборе

### Список игроков

- Отображение игроков из массива `places` устройства
- **Случайные имена игроков** — генерируются детерминированно на основе `device_id` и `place`
- Текущие балансы с цветовой индикацией (зелёный для положительного, красный для отрицательного)
- Операции с балансом для каждого игрока

### Операции с балансом

- **Поле ввода суммы** с валидацией в реальном времени
- **Кнопки "Deposit"** (пополнить) и **"Withdraw"** (снять)
- **Валидация**: сумма не более 2 знаков после запятой (например, 100.50 ✓, 100.567 ✗)
- Подробные комментарии в коде объясняют важность такой валидации в финансовых приложениях

### Обработка ошибок

- **Уведомления (toast)** при ошибках от сервера (недостаточно средств, некорректная сумма и т.д.)
- **Валидация поля ввода** с отображением ошибок под полем
- **Понятные сообщения об ошибках** для пользователя на русском языке
- Обработка различных HTTP статусов (400, 401, 408, 500)

## Архитектура

### Структура проекта

```
src/
├── api/              # API клиент и эндпоинты
│   ├── client.ts     # Axios конфигурация и обработка ошибок
│   ├── devices.ts    # API устройств
│   └── players.ts    # API игроков и операций с балансом
├── components/       # React компоненты
│   ├── icons/        # SVG иконки (DeviceIcon, UsersIcon, MoneyIcon и др.)
│   ├── DeviceList.tsx
│   ├── PlayerList.tsx
│   └── BalanceOperations.tsx
├── pages/            # Страницы приложения
│   ├── DevicesPage.tsx
│   └── PlayersPage.tsx
├── hooks/            # Кастомные хуки
│   ├── useDevices.ts
│   └── usePlayers.ts
├── context/          # React контексты
│   └── ToastContext.tsx
├── utils/            # Утилиты
│   ├── validation.ts # Валидация сумм
│   └── playerNames.ts # Генерация имён игроков
├── types/            # TypeScript типы
│   └── index.ts
├── config/           # Конфигурация
│   └── api.ts
├── App.tsx           # Главный компонент
└── main.tsx          # Точка входа
```

### Особенности реализации

- **Максимальное использование React-Bootstrap** — Card, Stack, Badge, ButtonGroup, Navbar, Form и другие компоненты
- **SVG иконки** вместо эмодзи для профессионального вида
- **Простой минималистичный дизайн** с акцентом на функциональность
- **Плавные анимации** для улучшения UX (появление элементов, hover-эффекты, переходы)
- **Lazy loading** списка игроков для оптимизации
- **Мемоизация компонентов** для производительности
- **TypeScript** для типобезопасности
- **TanStack Query** для кэширования и синхронизации данных

## Дизайн

- **Минималистичный стиль** с акцентом на читаемость и функциональность
- **Плоский дизайн** без излишних градиентов и эффектов
- **Цветовая индикация** балансов (зелёный/красный)
- **Адаптивная вёрстка** для мобильных и десктопных устройств
- **Плавные анимации** переходов и взаимодействий
- **Фиксированные тостеры** — всегда видны при скролле

## Тесты

Unit-тесты для валидации сумм (Vitest):

```bash
yarn test
```

Тесты проверяют корректность валидации формата суммы (не более 2 знаков после запятой).

## Разработка

### Основные команды

- `yarn dev` — запуск dev-сервера с hot reload
- `yarn build` — сборка для продакшна
- `yarn preview` — превью продакшн-сборки
- `yarn lint` — проверка кода линтером
- `yarn test` — запуск тестов

### Переменные окружения

- `VITE_API_BASE_URL` — базовый URL API (по умолчанию: `https://dev-space.su`)

## Лицензия

Private project
